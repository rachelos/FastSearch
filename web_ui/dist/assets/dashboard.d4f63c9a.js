import{_ as N,a as v,r,o as g,c as S,w as o,b as t,t as f,d as p,e as M,f as i,g as y,h as q,F as E,i as k,j as T,k as K,p as F,l as H,n as Z}from"./index.817e9243.js";import{j as G}from"./vue-json-viewer.78467871.js";const Q={name:"IndexDialog",props:{visible:{type:Boolean,default:!1},db:{type:String,default:""},data:{type:Object,default:()=>null}},data(){return{rules:{id:[{required:!0,message:"\u8BF7\u8F93\u5165ID",trigger:"blur"}],text:[{required:!0,message:"\u8BF7\u8F93\u5165\u7D22\u5F15\u6587\u672C",trigger:"blur"}],document:[{required:!0,message:"\u8BF7\u8F93\u5165JSON\u6587\u6863",trigger:"blur"}]},form:{id:"SN-"+Math.random().toString(36).substring(2),title:"",text:"",flag:"",tags:"",document:""}}},watch:{data(s){s?(this.form=s,s.originalText&&(this.form.text=s.originalText),s.originalTitle&&(this.form.title=s.originalTitle),this.form.document=JSON.stringify(s.document)):this.form={id:"SN-"+Math.random().toString(36).substring(2),text:"",document:""}}},methods:{example(){this.form.document=JSON.stringify({title:"\u6807\u9898",content:"\u5185\u5BB9",tags:["\u6807\u7B7E1","\u6807\u7B7E2"]})},save(){this.$refs.form.validate(s=>{if(s){let e={id:this.form.id,title:this.form.title,text:this.form.text,flag:this.form.flag,tags:this.form.tags,document:this.form.document};try{e.document=JSON.parse(this.form.document)}catch{this.$message.error("JSON\u6587\u6863\u683C\u5F0F\u9519\u8BEF");return}v.addIndex(this.db,e).then(({data:u})=>{console.log(u),u.state?(this.$message.success("\u6DFB\u52A0\u6210\u529F!"),this.$emit("success")):this.$message.error(u.message)})}})}}},W=p("\u8BF7\u4FDD\u6301ID\u7684\u552F\u4E00\uFF0C\u5982\u679C\u5B58\u5728\u5C06\u4F1A\u66F4\u65B0\u6570\u636E\u3002"),X=p("\u586B\u5165\u793A\u4F8B"),Y=p("\u786E\u5B9A");function $(s,e,u,c,l,a){const _=r("el-alert"),D=r("el-tag"),m=r("el-form-item"),h=r("el-input"),B=r("el-link"),x=r("el-form"),C=r("el-button"),w=r("el-dialog");return g(),S(w,{draggable:"",modelValue:u.visible,"onUpdate:modelValue":e[8]||(e[8]=d=>u.visible=d),onClose:e[9]||(e[9]=d=>s.$emit("close")),title:"\u6DFB\u52A0\u7D22\u5F15"},{footer:o(()=>[t(C,{type:"primary",onClick:e[7]||(e[7]=d=>a.save())},{default:o(()=>[Y]),_:1})]),default:o(()=>[t(_,{type:"success",style:{"margin-bottom":"10px"}},{default:o(()=>[W]),_:1}),t(x,{ref:"form",model:l.form,rules:l.rules,"label-width":"120px"},{default:o(()=>[t(m,{label:"\u6570\u636E\u5E93"},{default:o(()=>[t(D,{textContent:f(u.db)},null,8,["textContent"])]),_:1}),t(m,{label:"ID",prop:"id"},{default:o(()=>[t(h,{modelValue:l.form.id,"onUpdate:modelValue":e[0]||(e[0]=d=>l.form.id=d),disabled:u.data!=null,placeholder:"\u7D22\u5F15id"},null,8,["modelValue","disabled"])]),_:1}),t(m,{label:"\u6807\u9898",prop:"title"},{default:o(()=>[t(h,{type:"text",modelValue:l.form.title,"onUpdate:modelValue":e[1]||(e[1]=d=>l.form.title=d),placeholder:"\u6807\u9898"},null,8,["modelValue"])]),_:1}),t(m,{label:"\u7D22\u5F15\u6587\u672C",prop:"text"},{default:o(()=>[t(h,{type:"textarea",modelValue:l.form.text,"onUpdate:modelValue":e[2]||(e[2]=d=>l.form.text=d),placeholder:"\u7D22\u5F15\u6587\u672C",rows:5},null,8,["modelValue"])]),_:1}),t(m,{label:"\u6807\u8BC6",prop:"flag"},{default:o(()=>[t(h,{type:"text",modelValue:l.form.flag,"onUpdate:modelValue":e[3]||(e[3]=d=>l.form.flag=d),placeholder:"\u6807\u8BC6"},null,8,["modelValue"])]),_:1}),t(m,{label:"\u6807\u7B7E",prop:"tags"},{default:o(()=>[t(h,{type:"text",modelValue:l.form.tags,"onUpdate:modelValue":e[4]||(e[4]=d=>l.form.tags=d),placeholder:"\u6807\u7B7E"},null,8,["modelValue"])]),_:1}),t(m,{label:"JSON\u6587\u6863",prop:"document"},{default:o(()=>[t(h,{type:"textarea",modelValue:l.form.document,"onUpdate:modelValue":e[5]||(e[5]=d=>l.form.document=d),placeholder:"JSON\u6587\u672C",rows:5},null,8,["modelValue"]),t(B,{type:"success",onClick:e[6]||(e[6]=d=>a.example())},{default:o(()=>[X]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}var ee=N(Q,[["render",$]]);const te={name:"dashboard",components:{IndexDialog:ee,jsonViewer:G},data(){return{drawer:!1,drawer_data:"",dbs:{},currentDB:"",loading:!1,dialogVisible:!1,dialogData:null,params:{query:"",filterExp:"",scoreExp:"",page:1,limit:10,highlight:!0,negative:{query:!0,content:!1},order:"desc"},data:null}},watch:{currentDB(s){this.search()},"params.highlight"(s){this.search()}},computed:{databases(){let s=[];for(let e in this.dbs)s.push({label:e,value:e});return s},db(){return!this.currentDB||!this.dbs?null:this.dbs[this.currentDB]},tableData(){return this.data?this.data.documents:null}},mounted(){this.params.query=this.queryURLParams("query")||"",this.params.filterExp=this.queryURLParams("filterExp")||"",this.params.filterExp=this.queryURLParams("filterExp")||""},created(){this.getDatabases()},methods:{queryURLParams:function(s,e){e=e||window.location;let u=/([^?&=]+)=([^&]+)/g,c={},l;for(;(l=u.exec(e))!==null;){let a=decodeURIComponent(l[1]),_=decodeURIComponent(l[2]);c[a]?Array.isArray(c[a])?c[a].push(_):c[a]=[c[a],_]:c[a]=_}return s?c[s]?c[s]:"":c},sortChange({column:s,prop:e,order:u}){u==="ascending"?this.params.order="ASC":this.params.order="DESC",this.search()},createDB(){this.$prompt("\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u540D\u79F0","\u65B0\u5EFA\u6570\u636E\u5E93",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",inputPattern:/^[a-zA-Z][a-zA-Z0-9]{1,19}$/,inputErrorMessage:"\u6570\u636E\u5E93\u540D\u79F0\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u548C\u6570\u5B57\uFF0C\u4E14\u5FC5\u987B\u4EE5\u5B57\u6BCD\u5F00\u5934\uFF0C\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC720\u4E2A\u5B57\u7B26"}).then(({value:s})=>{v.create(s).then(({data:e})=>{e.state?(this.$message.success(e.message),this.getDatabases()):this.$message.error(e.message)}).catch(()=>{this.$message.error("\u521B\u5EFA\u5931\u8D25")})}).catch(()=>{this.$message({type:"info",message:"\u53D6\u6D88\u521B\u5EFA\u6570\u636E\u5E93"})})},addIndex(){this.dialogData=null,this.dialogVisible=!0},indexSuccess(){this.search(),this.dialogVisible=!1},selectDB(s){for(let e in this.dbs)this.dbs[e].active=!1;s.active=!0,this.$forceUpdate(),this.currentDB=s.DatabaseName},sizeChange(s){this.params.limit=s,this.$nextTick(()=>this.search())},currentChange(s){this.params.page=s,this.$nextTick(()=>this.search())},getDatabases(){v.getDatabase().then(s=>{s.status||this.$message.error(s.message),this.dbs=s.data.data;for(let e in this.dbs){this.dbs[e].active=!0;break}this.$nextTick(()=>{this.databases.length>0&&(this.currentDB=this.databases[0].value),this.$forceUpdate()})})},search(){this.params.query!=""&&(this.loading=!0,v.query(this.currentDB,this.params).then(s=>{s.data.state||this.$message.error(s.data.message),this.data=s.data.data}).finally(()=>{this.loading=!1}))},updateRow(s){this.dialogData=s,this.dialogVisible=!0},showRow(s){this.drawer_data=s,this.drawer=!0},deleteRow(s){let e=this;this.$confirm("\u786E\u5B9A\u5220\u9664\u5417\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{v.remove(this.currentDB,s.id).then(u=>{if(console.log(u.data),!u.data.state){this.$message.error(u.data.message);return}this.$message.success("\u5220\u9664\u6210\u529F"),e.search()})}).catch(()=>{this.$message({type:"info",message:"\u5DF2\u53D6\u6D88\u5220\u9664"})})},drop(){let s=this;this.$confirm("\u786E\u5B9A\u5220\u9664\u5417\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{v.drop(this.currentDB).then(({data:e})=>{e.state?(this.$message.success("\u5220\u9664\u6210\u529F"),s.getDatabases()):(console.log(e),this.$message.error(e.message))})}).catch(()=>{this.$message({type:"info",message:"\u5DF2\u53D6\u6D88\u5220\u9664"})})}}},V=s=>(F("data-v-25b48d72"),s=s(),H(),s),le={style:{display:"flex","justify-content":"space-between","align-items":"center"}},se=p(" \u7D22\u5F15\u5E93\u5217\u8868 "),ne=p("\u521B\u5EFA"),oe={class:"database"},ae=["onClick"],re=["textContent"],ie={id:"dashboard"},de={style:{display:"flex","justify-content":"space-between"}},ue={key:0},me=V(()=>i("span",null,"\u5B58\u50A8\u8DEF\u5F84\uFF1A",-1)),pe=p("\u5220\u9664"),ce=p("\u5237\u65B0"),ge={class:"header"},he={style:{display:"flex","justify-content":"space-between"}},fe=p("\u6DFB\u52A0\u7D22\u5F15"),_e={style:{display:"block"}},be=p("\u67E5\u8BE2"),ye={style:{"margin-left":"10px"}},xe=V(()=>i("span",{style:{"font-size":"12px"}},"\u5173\u952E\u8BCD\u9AD8\u4EAE\uFF1A",-1)),ve={style:{"margin-left":"10px"}},Ce=V(()=>i("span",{style:{"font-size":"12px"}},"\u5173\u952E\u8BCD\u8D1F\u9762\u62E6\u622A:",-1)),we={style:{"margin-left":"10px"}},Ve=V(()=>i("span",{style:{"font-size":"12px"}},"\u7ED3\u679C\u8D1F\u9762\u62E6\u622A:",-1)),De={key:0,style:{"margin-top":"10px"}},ke={key:0},Se=V(()=>i("div",null,[i("b",null,"\u5206\u8BCD\u7ED3\u679C\uFF1A")],-1)),Be=["innerHTML"],Ue=p("\u663E\u793A"),ze=p("\u4FEE\u6539"),Te=p("\u5220\u9664"),Ie={key:1,style:{"margin-top":"10px"}};function qe(s,e,u,c,l,a){const _=r("coin"),D=r("el-icon"),m=r("el-button"),h=r("el-card"),B=r("el-aside"),x=r("el-tag"),C=r("el-input"),w=r("el-switch"),d=r("el-pagination"),R=r("el-alert"),I=r("json-viewer"),b=r("el-table-column"),U=r("el-link"),j=r("el-table"),O=r("el-main"),J=r("el-drawer"),L=r("IndexDialog"),P=r("el-container"),A=M("loading");return g(),S(P,null,{default:o(()=>[t(B,{width:"230px"},{default:o(()=>[t(h,null,{header:o(()=>[i("div",le,[i("div",null,[t(D,null,{default:o(()=>[t(_,{color:"rgb(105, 192, 255)"})]),_:1}),se]),i("div",null,[t(m,{type:"text",icon:"plus",onClick:e[0]||(e[0]=n=>a.createDB())},{default:o(()=>[ne]),_:1})])])]),default:o(()=>[i("div",oe,[(g(!0),y(E,null,q(l.dbs,n=>(g(),y("div",{class:Z({item:!0,active:n.active}),onClick:z=>a.selectDB(n)},[t(D,null,{default:o(()=>[t(_,{color:"rgb(105, 192, 255)"})]),_:1}),i("span",{class:"name",textContent:f(n.DatabaseName)},null,8,re)],10,ae))),256))])]),_:1})]),_:1}),t(O,{style:{"padding-top":"0"}},{default:o(()=>[i("div",ie,[t(h,{style:{"margin-bottom":"20px"}},{default:o(()=>[i("div",de,[a.db?(g(),y("div",ue,[me,t(x,{textContent:f(a.db.IndexPath)},null,8,["textContent"]),t(x,{textContent:f(a.db.DocumentCount),title:"\u7EAA\u5F55"},null,8,["textContent"])])):k("",!0),i("div",null,[t(m,{style:{"margin-left":"10px"},type:"danger",onClick:e[1]||(e[1]=n=>a.drop()),plain:"",icon:"close"},{default:o(()=>[pe]),_:1}),t(m,{style:{"margin-left":"10px"},type:"success",onClick:e[2]||(e[2]=n=>a.search()),icon:"refresh"},{default:o(()=>[ce]),_:1})])])]),_:1}),t(h,null,{header:o(()=>[i("div",ge,[i("div",he,[t(m,{icon:"plus",type:"success",style:{"margin-right":"10px"},onClick:e[3]||(e[3]=n=>a.addIndex())},{default:o(()=>[fe]),_:1}),i("div",_e,[t(C,{onKeyup:e[5]||(e[5]=T(n=>a.search(),["enter"])),modelValue:l.params.query,"onUpdate:modelValue":e[6]||(e[6]=n=>l.params.query=n),placeholder:"\u8F93\u5165\u5173\u952E\u5B57,Enter"},{append:o(()=>[t(m,{type:"primary",onClick:e[4]||(e[4]=n=>a.search())},{default:o(()=>[be]),_:1})]),_:1},8,["modelValue"]),t(C,{style:{float:"left","margin-right":"10px"},onKeyup:e[7]||(e[7]=T(n=>a.search(),["enter"])),modelValue:l.params.filterExp,"onUpdate:modelValue":e[8]||(e[8]=n=>l.params.filterExp=n),placeholder:"\u8FC7\u6EE4\u6761\u4EF6\uFF0C\u4F8B\u5982: flag=='1' "},null,8,["modelValue"]),t(C,{style:{float:"left","margin-right":"10px"},onKeyup:e[9]||(e[9]=T(n=>a.search(),["enter"])),modelValue:l.params.scoreExp,"onUpdate:modelValue":e[10]||(e[10]=n=>l.params.scoreExp=n),placeholder:"\u6392\u5E8F\u6761\u4EF6\uFF0C\u4F8B\u5982: score+[document.sort]"},null,8,["modelValue"])]),i("div",ye,[xe,t(w,{modelValue:l.params.highlight,"onUpdate:modelValue":e[11]||(e[11]=n=>l.params.highlight=n)},null,8,["modelValue"])]),i("div",ve,[Ce,t(w,{modelValue:l.params.negative.query,"onUpdate:modelValue":e[12]||(e[12]=n=>l.params.negative.query=n)},null,8,["modelValue"])]),i("div",we,[Ve,t(w,{modelValue:l.params.negative.content,"onUpdate:modelValue":e[13]||(e[13]=n=>l.params.negative.content=n)},null,8,["modelValue"])])])]),l.data&&l.data.pageCount>1?(g(),y("div",De,[t(d,{onSizeChange:a.sizeChange,onCurrentChange:a.currentChange,layout:"total, sizes, prev, pager, next, jumper",small:"small","page-sizes":[10,20,30,50,100,200,300,500],background:"","page-size":l.params.limit,"current-page":l.params.page,total:l.data.total},null,8,["onSizeChange","onCurrentChange","page-size","current-page","total"])])):k("",!0)]),default:o(()=>[l.data?(g(),y("div",ke,[t(R,{type:"success",style:{"margin-bottom":"10px"}},{default:o(()=>[i("div",null," \u67E5\u8BE2\u8017\u65F6\uFF1A"+f(l.data.time)+"ms\uFF0C\u627E\u5230\uFF1A"+f(l.data.total)+"\u4E2A\u7ED3\u679C\uFF0C\u6BCF\u9875"+f(l.params.limit)+"\u6761\uFF0C\u603B\u5171"+f(l.data.pageCount)+"\u9875 ",1),Se,i("div",null,[(g(!0),y(E,null,q(l.data.words,n=>(g(),S(x,{style:{"margin-right":"10px"},textContent:f(n),key:n},null,8,["textContent"]))),128))])]),_:1})])):k("",!0),K((g(),S(j,{stripe:!0,data:a.tableData,style:{width:"100%"},onSortChange:a.sortChange},{default:o(()=>[t(b,{fixed:"",type:"expand",prop:"document",label:"Document",width:"100"},{default:o(n=>[t(I,{value:n.row,"expand-depth":5,copyable:"",boxed:"",sort:""},null,8,["value"])]),_:1}),t(b,{prop:"id",label:"ID",sortable:""}),t(b,{prop:"title",label:"Title"},{default:o(n=>[i("span",{innerHTML:n.row.title},null,8,Be)]),_:1}),t(b,{prop:"flag",label:"Flag"}),t(b,{prop:"tags",label:"Tags"}),t(b,{prop:"score",label:"Score",width:"80"},{default:o(n=>[t(x,{textContent:f(n.row.score)},null,8,["textContent"])]),_:1}),t(b,{fixed:"right",prop:"operation",label:"Operation",width:"160"},{default:o(n=>[t(U,{onClick:z=>a.showRow(n.row),type:"primary",style:{"margin-right":"10px"}},{default:o(()=>[Ue]),_:2},1032,["onClick"]),t(U,{onClick:z=>a.updateRow(n.row),type:"primary",style:{"margin-right":"10px"}},{default:o(()=>[ze]),_:2},1032,["onClick"]),t(U,{onClick:z=>a.deleteRow(n.row),type:"danger"},{default:o(()=>[Te]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSortChange"])),[[A,l.loading]]),l.data&&l.data.pageCount>1?(g(),y("div",Ie,[t(d,{onSizeChange:a.sizeChange,onCurrentChange:a.currentChange,layout:"total, sizes, prev, pager, next, jumper",small:"small","page-sizes":[10,20,30,50,100,200,300,500],background:"","page-size":l.params.limit,"current-page":l.params.page,total:l.data.total},null,8,["onSizeChange","onCurrentChange","page-size","current-page","total"])])):k("",!0)]),_:1})])]),_:1}),t(J,{modelValue:l.drawer,"onUpdate:modelValue":e[14]||(e[14]=n=>l.drawer=n),title:l.drawer_data.originalTitle},{default:o(()=>[t(I,{value:l.drawer_data,"expand-depth":5,copyable:"",boxed:"",sort:""},null,8,["value"])]),_:1},8,["modelValue","title"]),t(L,{data:l.dialogData,db:l.currentDB,visible:l.dialogVisible,onSuccess:e[15]||(e[15]=n=>a.indexSuccess()),onClose:e[16]||(e[16]=n=>l.dialogVisible=!1)},null,8,["data","db","visible"])]),_:1})}var Re=N(te,[["render",qe],["__scopeId","data-v-25b48d72"]]);export{Re as default};
