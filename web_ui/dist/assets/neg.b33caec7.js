import{_ as z,a as v,r as n,o as g,c as y,w as r,b as a,i as C,d as c,e as j,f as p,j as k,g as x,t as f,F as N,h as L,k as K,p as P,l as A}from"./index.817e9243.js";import{j as F}from"./vue-json-viewer.78467871.js";const H={name:"IndexDialog",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>null}},data(){return{rules:{text:[{required:!0,message:"\u8BF7\u8F93\u5165\u8D1F\u9762\u8BCD",trigger:"blur"}]},form:{title:"",text:""}}},watch:{data(t){t?(this.form=t,t.originalText&&(this.form.text=t.originalText),t.originalTitle&&(this.form.title=t.originalTitle)):this.form={text:"",title:""}}},methods:{save(){this.$refs.form.validate(t=>{if(t){let e={id:this.form.id,title:this.form.title,text:this.form.text,flag:this.form.flag};v.neg_add(this.db,e).then(({data:i})=>{console.log(i),i.state?(this.$message.success("\u6DFB\u52A0\u6210\u529F!"),this.$emit("success")):this.$message.error(i.message)})}})}}},M=c("\u8BF7\u4FDD\u6301ID\u7684\u552F\u4E00\uFF0C\u5982\u679C\u5B58\u5728\u5C06\u4F1A\u66F4\u65B0\u6570\u636E\u3002"),O=c("\u786E\u5B9A");function G(t,e,i,u,l,o){const m=n("el-alert"),h=n("el-input"),_=n("el-form-item"),w=n("el-form"),V=n("el-button"),b=n("el-dialog");return g(),y(b,{draggable:"",modelValue:i.visible,"onUpdate:modelValue":e[4]||(e[4]=d=>i.visible=d),onClose:e[5]||(e[5]=d=>t.$emit("close")),title:"\u6DFB\u52A0\u8D1F\u9762\u8BCD"},{footer:r(()=>[a(V,{type:"primary",onClick:e[3]||(e[3]=d=>o.save())},{default:r(()=>[O]),_:1})]),default:r(()=>[a(m,{type:"success",style:{"margin-bottom":"10px"}},{default:r(()=>[M]),_:1}),a(w,{ref:"form",model:l.form,rules:l.rules,"label-width":"120px"},{default:r(()=>[l.form.id?(g(),y(_,{key:0,label:"ID",prop:"id"},{default:r(()=>[a(h,{modelValue:l.form.id,"onUpdate:modelValue":e[0]||(e[0]=d=>l.form.id=d),disabled:i.data!=null,placeholder:"\u7D22\u5F15id"},null,8,["modelValue","disabled"])]),_:1})):C("",!0),a(_,{label:"\u6807\u9898",prop:"title"},{default:r(()=>[a(h,{type:"text",modelValue:l.form.title,"onUpdate:modelValue":e[1]||(e[1]=d=>l.form.title=d),placeholder:"\u6807\u9898"},null,8,["modelValue"])]),_:1}),a(_,{label:"\u8D1F\u9762\u8BCD",prop:"text"},{default:r(()=>[a(h,{type:"textarea",modelValue:l.form.text,"onUpdate:modelValue":e[2]||(e[2]=d=>l.form.text=d),placeholder:"\u8BF7\u8F93\u5165\u8D1F\u9762\u8BCD",rows:5},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}var J=z(H,[["render",G]]);const Q={name:"dashboard",components:{NegDialog:J,jsonViewer:F},data(){return{drawer:!1,drawer_data:"",dbs:{},currentDB:"",loading:!1,dialogVisible:!1,dialogData:null,params:{query:"",filterExp:"",scoreExp:"",page:1,limit:10,highlight:!0,order:"desc"},data:null}},watch:{currentDB(t){this.search()},"params.highlight"(t){this.search()}},computed:{databases(){let t=[];for(let e in this.dbs)t.push({label:e,value:e});return t},db(){return!this.currentDB||!this.dbs?null:this.dbs[this.currentDB]},tableData(){return this.data?this.data.documents:null}},mounted(){this.params.query=this.queryURLParams("query")||"",this.params.filterExp=this.queryURLParams("filterExp")||"",this.params.filterExp=this.queryURLParams("filterExp")||""},created(){this.search()},methods:{queryURLParams:function(t,e){e=e||window.location;let i=/([^?&=]+)=([^&]+)/g,u={},l;for(;(l=i.exec(e))!==null;){let o=decodeURIComponent(l[1]),m=decodeURIComponent(l[2]);u[o]?Array.isArray(u[o])?u[o].push(m):u[o]=[u[o],m]:u[o]=m}return t?u[t]?u[t]:"":u},sortChange({column:t,prop:e,order:i}){i==="ascending"?this.params.order="ASC":this.params.order="DESC",this.search()},addNeg(){this.dialogData=null,this.dialogVisible=!0},indexSuccess(){this.search(),this.dialogVisible=!1},selectDB(t){for(let e in this.dbs)this.dbs[e].active=!1;t.active=!0,this.$forceUpdate(),this.currentDB=t.DatabaseName},sizeChange(t){this.params.limit=t,this.$nextTick(()=>this.search())},currentChange(t){this.params.page=t,this.$nextTick(()=>this.search())},search(){this.loading=!0,v.neg_query(this.currentDB,this.params).then(t=>{t.data.state||this.$message.error(t.message),this.data=t.data.data}).finally(()=>{this.loading=!1})},apply(){this.loading=!0,v.neg_apply(this.currentDB,this.params).then(t=>{console.log(t),this.$message.info(t.data.message)}).finally(()=>{this.loading=!1})},updateRow(t){this.dialogData=t,this.dialogVisible=!0},showRow(t){this.drawer_data=t,this.drawer=!0},deleteRow(t){let e=this;this.$confirm("\u786E\u5B9A\u5220\u9664\u5417\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{v.neg_remove(this.currentDB,t.id).then(i=>{if(console.log(i.data),!i.data.state){this.$message.error(i.data.message);return}this.$message.success("\u5220\u9664\u6210\u529F"),e.search()})}).catch(()=>{this.$message({type:"info",message:"\u5DF2\u53D6\u6D88\u5220\u9664"})})}}},W=t=>(P("data-v-3f793d62"),t=t(),A(),t),X={id:"dashboard"},Y={class:"header"},Z={style:{display:"flex","justify-content":"space-between"}},$=c("\u6DFB\u52A0"),ee={style:{display:"block"}},te=c("\u67E5\u8BE2"),le={key:0,style:{"margin-top":"10px"}},ae={style:{display:"flex"}},se=c("\u5E94\u7528"),oe={key:0},re=W(()=>p("div",null,[p("b",null,"\u5206\u8BCD\u7ED3\u679C\uFF1A")],-1)),ne=["innerHTML"],ie=c("\u663E\u793A"),de=c("\u4FEE\u6539"),ue=c("\u5220\u9664"),pe={key:1,style:{"margin-top":"10px"}};function me(t,e,i,u,l,o){const m=n("el-button"),h=n("el-input"),_=n("el-pagination"),w=n("el-tag"),V=n("el-alert"),b=n("json-viewer"),d=n("el-table-column"),D=n("el-link"),S=n("el-table"),U=n("el-card"),T=n("el-main"),E=n("el-drawer"),R=n("NegDialog"),q=n("el-container"),I=j("loading");return g(),y(q,null,{default:r(()=>[a(T,{style:{"padding-top":"0"}},{default:r(()=>[p("div",X,[a(U,null,{header:r(()=>[p("div",Y,[p("div",Z,[a(m,{icon:"plus",type:"success",style:{"margin-right":"10px"},onClick:e[0]||(e[0]=s=>o.addNeg())},{default:r(()=>[$]),_:1}),p("div",ee,[a(h,{onKeyup:e[2]||(e[2]=k(s=>o.search(),["enter"])),modelValue:l.params.query,"onUpdate:modelValue":e[3]||(e[3]=s=>l.params.query=s),placeholder:"\u8F93\u5165\u5173\u952E\u5B57,Enter"},{append:r(()=>[a(m,{type:"primary",onClick:e[1]||(e[1]=s=>o.search())},{default:r(()=>[te]),_:1})]),_:1},8,["modelValue"]),a(h,{style:{float:"left","margin-right":"10px"},onKeyup:e[4]||(e[4]=k(s=>o.search(),["enter"])),modelValue:l.params.filterExp,"onUpdate:modelValue":e[5]||(e[5]=s=>l.params.filterExp=s),placeholder:"\u8FC7\u6EE4\u6761\u4EF6\uFF0C\u4F8B\u5982: flag=='1' "},null,8,["modelValue"]),a(h,{style:{float:"left","margin-right":"10px"},onKeyup:e[6]||(e[6]=k(s=>o.search(),["enter"])),modelValue:l.params.scoreExp,"onUpdate:modelValue":e[7]||(e[7]=s=>l.params.scoreExp=s),placeholder:"\u6392\u5E8F\u6761\u4EF6\uFF0C\u4F8B\u5982: score+[document.sort]"},null,8,["modelValue"])])])]),l.data&&l.data.pageCount>1?(g(),x("div",le,[a(_,{onSizeChange:o.sizeChange,onCurrentChange:o.currentChange,layout:"total, sizes, prev, pager, next, jumper",small:"small","page-sizes":[10,20,30,50,100,200,300,500],background:"","page-size":l.params.limit,"current-page":l.params.page,total:l.data.total},null,8,["onSizeChange","onCurrentChange","page-size","current-page","total"])])):C("",!0),p("div",ae,[a(m,{style:{"margin-right":"10px"},onClick:e[8]||(e[8]=s=>o.apply())},{default:r(()=>[se]),_:1})])]),default:r(()=>[l.data?(g(),x("div",oe,[a(V,{type:"success",style:{"margin-bottom":"10px"}},{default:r(()=>[p("div",null," \u67E5\u8BE2\u8017\u65F6\uFF1A"+f(l.data.time)+"ms\uFF0C\u627E\u5230\uFF1A"+f(l.data.total)+"\u4E2A\u7ED3\u679C\uFF0C\u6BCF\u9875"+f(l.params.limit)+"\u6761\uFF0C\u603B\u5171"+f(l.data.pageCount)+"\u9875 ",1),re,p("div",null,[(g(!0),x(N,null,L(l.data.words,s=>(g(),y(w,{style:{"margin-right":"10px"},textContent:f(s),key:s},null,8,["textContent"]))),128))])]),_:1})])):C("",!0),K((g(),y(S,{stripe:!0,data:o.tableData,style:{width:"100%"},onSortChange:o.sortChange},{default:r(()=>[a(d,{fixed:"",type:"expand",prop:"document",label:"Document",width:"100"},{default:r(s=>[a(b,{value:s.row,"expand-depth":5,copyable:"",boxed:"",sort:""},null,8,["value"])]),_:1}),a(d,{prop:"id",label:"ID",sortable:"",width:"380"}),a(d,{prop:"title",label:"Title"},{default:r(s=>[p("span",{innerHTML:s.row.title},null,8,ne)]),_:1}),a(d,{prop:"time",label:"Time",sortable:""}),a(d,{fixed:"right",prop:"operation",label:"Operation",width:"160"},{default:r(s=>[a(D,{onClick:B=>o.showRow(s.row),type:"primary",style:{"margin-right":"10px"}},{default:r(()=>[ie]),_:2},1032,["onClick"]),a(D,{onClick:B=>o.updateRow(s.row),type:"primary",style:{"margin-right":"10px"}},{default:r(()=>[de]),_:2},1032,["onClick"]),a(D,{onClick:B=>o.deleteRow(s.row),type:"danger"},{default:r(()=>[ue]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSortChange"])),[[I,l.loading]]),l.data&&l.data.pageCount>1?(g(),x("div",pe,[a(_,{onSizeChange:o.sizeChange,onCurrentChange:o.currentChange,layout:"total, sizes, prev, pager, next, jumper",small:"small","page-sizes":[10,20,30,50,100,200,300,500],background:"","page-size":l.params.limit,"current-page":l.params.page,total:l.data.total},null,8,["onSizeChange","onCurrentChange","page-size","current-page","total"])])):C("",!0)]),_:1})])]),_:1}),a(E,{modelValue:l.drawer,"onUpdate:modelValue":e[9]||(e[9]=s=>l.drawer=s),title:l.drawer_data.originalTitle},{default:r(()=>[a(b,{value:l.drawer_data,"expand-depth":5,copyable:"",boxed:"",sort:""},null,8,["value"])]),_:1},8,["modelValue","title"]),a(R,{data:l.dialogData,db:l.currentDB,visible:l.dialogVisible,onSuccess:e[10]||(e[10]=s=>o.indexSuccess()),onClose:e[11]||(e[11]=s=>l.dialogVisible=!1)},null,8,["data","db","visible"])]),_:1})}var he=z(Q,[["render",me],["__scopeId","data-v-3f793d62"]]);export{he as default};
